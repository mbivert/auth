<!DOCTYPE>
<html>
	<head>
		<meta charset="utf-8">
		<title>Test page</title>
		<script>
		function mkSignIn() {
			let p = document.createElement("form");

				let ql = document.createElement("label");
				ql.textContent = "Name ";
				ql.setAttribute("for", "name");

				let q = document.createElement("input");
				q.setAttribute("type", "text")
				q.setAttribute("name", "name")

				let sl = document.createElement("label");
				sl.textContent = "Password ";
				sl.setAttribute("for", "passwd");

				let s = document.createElement("input");
				s.setAttribute("type", "email")
				s.setAttribute("name", "passwd")

				let rl = document.createElement("label");
				rl.textContent = "Email ";
				rl.setAttribute("for", "email");

				let r = document.createElement("input");
				r.setAttribute("type", "email")
				r.setAttribute("email", "email")

				let b = document.createElement("button")
				b.textContent = "Submit"

				p.appendChild(ql);
				p.appendChild(q);
				p.appendChild(document.createElement("br"));
				p.appendChild(sl);
				p.appendChild(s);
				p.appendChild(document.createElement("br"));
				p.appendChild(rl);
				p.appendChild(r);
				p.appendChild(document.createElement("br"));
				p.appendChild(b);

			b.addEventListener("click", function(e) {
				e.preventDefault()
				console.log(e);

				let xhr = new XMLHttpRequest();
				let url = "/auth/signin"
				xhr.open("POST", url);
				xhr.setRequestHeader('Content-Type', 'application/json');

				xhr.onload = function() {
				    if (xhr.status != 200) {
				    	console.log("cannot retrieve "+url+": "+xhr.responseText);
				    	return;
					}
					console.log(xhr.response);
				};

				xhr.send(JSON.stringify({
					"name"   : q.value,
					"passwd" : s.value,
					"email"  : r.value,
				}));
			});

			return p;
		}
		window.addEventListener('load', function() {
			document.getElementById("signin-form").replaceWith(mkSignIn());
		});
		</script>
	</head>
	<body>
		<h2>Sign-in</h2>
		<div id="signin-form"></div>

		<h2>Log-in</h2>
		<form>
			<label for="login">Login (name or email)</label>
			<input name="login" type="text"/>
			<br />
			<label for="passwd">Password</label>
			<input name="passwd" type="password"/>
			<br />
			<button type="submit" id="submit-login">Submit</button>
		</form>
	</body>
</html>